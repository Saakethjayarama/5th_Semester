# Module 3

- Regular file
- directory file
- fifo file api
- block file api
- character file api
- General files apis
- file and record locking
- device file apis
- fifo file apis
- symbolic link file apis

# Files in unix and posix system may be anyone of the following types

- Regular file
- Directory file
- Fifo file
- Block device file
- Character device file
- Symbolic link file

There are special apis to create these type of files. There is a set of generic apis that can be used to manipulate and create more than one type of files
Some of the functions are

- Open
- Create
- Read
- Write
- Close
- fcntl
- lseek
- link
- unlink
- stat
- fstat
- access
- chmod
- fchmod
- chown
- fchown
- utime

# Open

- It is used to establish a connection between a process and a file
- It opens an existing file
- It is also used to create a file
- It returns an integer called as file descrypter which contains inode information
- #include<sys/types.h>
  #include<sys/fcntl.h>
  int open(pathname, access mode, permission)
  returns -1 for error
  accessmode can take 3 values :- O_RDONLY, W_WRONLY, O_RDWR
  EG: int fd = open("x.txt", O_RDWR, 0)
  3rd param:
  ```
    S_IRUSR: read by user
    S_IWUSR: write by user
    S_IXUSR: execute by user
    S_IRWXU: Read, write, execute by user
  ```

# Create

- It is used to create new regular files

  ```
      #include<sys/types.h>
      #include<unistd.h>
      int create(pathname, mode)
  ```

  returns -1 for err

  ```
    #define create(path, mode)
    open(path,O_WRONLY | O_CREAT | O_TRUNC, mode)
  ```

# Read

- Fetches a fixed size block of data from a file reffered by fd

  ```
  #include<sys/types.h>
  #include<unistd.h>

  size_t read(fd, *buffer, nbytes)
  ```

  If success, it returns the no of bytes actually read.
  -1 for err

  sec arg is address of buffer which holds the data

# write

- opp of read
- used to write data into file
- write fixed block size at a time

  ```
  #include<sys/types.h>
  #include<unistd.h>

  size_t write(fd, buffer, size)
  ```

  if success returns no of bytes written to file
  -1 for error

# close

- Used to terminate the connection between process and file

  ```
  #include<unistd.h>
  int close(int fd)
  ```

  0 for success and -1 for error
  a process may open upto OPEN_MAX files.
  close function deallocate sys resources like file table entry, memory buffers..etc

# fcntl

- helps the user to query or set the flags

  ```
  #include<fcntl.h>
  int fcntl(fd, int cmd, ...)
  ```

  sec arg specifies the operation to be performed
  third arg depends on the value of sec arg
  possible cmd values are F_GETFL, F_SETFL
  FGETFL :- returns the access control flags of file descrypter
  F_SETFL :- sets or clears the access control flags

  ```
  char buf[300]
  int fd = open("x.txt", O_RDONLY);
  int rc = read(fd, buf, 256); //256 bytes
  close(fd);
  ```

# lseek

- It is used to change the file offset to a different value
- It alows the process to perform random acces of data of any open file

  ```
  #include<sys/types.h>
  #include<unistd.h>
  off_t lseek(fd, POS, whence)
  ```

  success returns offset
  -1 for error
  whencevalues reflocation
  SEEK_CUR cur file ptr address
  SEEK_SET begining of a file
  SEEK_END ending of a file

  if a file is opened for readonly lseek will file
  if a file is having a right access then lseek will succeed

# link

- the link fun creates a new link for the existing file

  ```
  #include<unistd.h>
  int link(cur_link, new_link)
  ```

  0 for success
  -1 for err

  hardlink count will be incremented by one if this fn succeeds
  unix ln command is implemented using this link

  test_ln.c

  ```
    #include<iostream.h>
    #include<stdio.h>
    #include<unistd.h>

    int main(int argc, char* argv[]) {
        if(argc != 3){
            printf("Usage: test_ln <src file> <dst file>\n")
            exit(-1)
        }

        if(link(argv[1], argv[2]) == -1) {
            printf("Link failure")
            exit(-1)
        }
        return 0
    }
  ```

# unlink

- opp of link
- deletes the link of an existing file
- this fn decreases the link count by one
- file link is physically removed from the file system when the link count is 0

```
    #include<unistd.h>
    int unlin(cur_link)
```

0 for success
-1 for err
unix mv command may be implemented by using unlinke fn
test_unlink.c

```
#include<stdio.h>
#include<unistd.h>
#include<string.h>

int main(int argc, char * argv[]){
    if(argc != 3) {
        printf("Usage: test_unlink <file1> <file2>")
        exit(-1);
    }
    if(link(argv[1], argv[2]) == 0) {
        return unlink(argv[1]);
    }else{
        return 1
    }
}

```
