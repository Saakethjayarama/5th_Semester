# What is Daemon

- A daemon is (or service) is a background process that is designed to run atonomously, with little or no user intervention.
- Eg: Apache web server httpd
  It waits in the background listening on specific ports and serve pages or processes scripts, based on type of request.

# Creating a daemon in linux

- It uses a specific set of rules in a given order.
- Knowing how they work will help us to understand how daemons operate in linux
- Few daemons interface with kernel modules that work with hardware devices such as external controller boards, printers and pdas
- A Daemon shld do one thing and shld do it well.
- One thing may be database service, mail service , file service, application service..etc
- Daemons shld never have direct communication with a user through a terminal.
- All communications should pass through some sort of interface.

# Basic characteristics of daemons

- Whena daemon starts up it has to do some low level house work to get itself ready for its real job.
- When a daemon starts up it has to follow few steps
  1. Fork off the parent process.
  2. Change the file mode mask that is umask.
  3. Open any log files for writing.
  4. Create a unique series id(sid).
  5. Change the current working directory to a safe place.
  6. Close standard file descriptors.
  7. Enter the actual daemon code.

```
#include<unistd.h>
#include<sys/types.h>
#include<fcntl.h>

int daemon_initialize(){
    pid_t pid;
    if((pid = fork()) < 0){
        return(-1);
    }else if(pid != 0) {
        exit(0);
        //exitting parent
    }
    // child continues
    setid();
    chdir("/");
    umask(0);
    return 0;
}
```

# Error logging

- Daemons cannot write to standard error since it does not have a a controlling terminal
- We do not all the daemons writing to the console device therefore a central daemon error loggin facility is required.
- There are three ways to generate log messages
  1. Kernel routines can call the log functions
     - These messages can be read by any user process that opens and reads the /dev/klog device
  2. Most of the daemons created by users call the syslog function to generate log messages. This causes the message to be sent to the unix domain datagram socket. /dev/log
  3. A user process on the host are some other host that is connected by tcp ip network can send messages to UDP Port 514

```
#include<syslog.h>

void openlog(char s, int option, int facility));
void syslog(int priority, const char *format, ...);
void closelog(void);
int setlogmask(int maskpri);

```
